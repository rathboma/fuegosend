<div class="container-fluid py-4" style="max-width: 1400px;">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2">
          <li class="breadcrumb-item"><%= link_to "Subscribers", subscribers_path %></li>
          <li class="breadcrumb-item active" aria-current="page"><%= @subscriber.email %></li>
        </ol>
      </nav>
      <h1 class="fs-2 mb-0"><%= @subscriber.email %></h1>
      <span class="badge status-<%= @subscriber.status %> mt-2"><%= @subscriber.status.titleize %></span>
    </div>
    <div class="d-flex gap-2">
      <%= link_to "Edit", edit_subscriber_path(@subscriber), class: "btn btn-outline-secondary" %>
      <%= button_to "Delete", @subscriber, method: :delete, data: { turbo_confirm: "Are you sure you want to delete this subscriber?" }, class: "btn btn-outline-danger" %>
    </div>
  </div>

  <!-- Subscriber Details -->
  <div class="row g-4 mb-4">
    <div class="col-md-6">
      <div class="card border h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">Details</h5>
          <div class="row g-3">
            <div class="col-12">
              <div class="text-muted small mb-1">Email</div>
              <div class="fw-semibold"><%= @subscriber.email %></div>
            </div>
            <div class="col-6">
              <div class="text-muted small mb-1">Status</div>
              <div><span class="badge status-<%= @subscriber.status %>"><%= @subscriber.status.titleize %></span></div>
            </div>
            <div class="col-6">
              <div class="text-muted small mb-1">Source</div>
              <div class="fw-semibold"><%= @subscriber.source || "—" %></div>
            </div>
            <div class="col-6">
              <div class="text-muted small mb-1">Created</div>
              <div class="fw-semibold"><%= @subscriber.created_at.strftime("%B %d, %Y") %></div>
            </div>
            <div class="col-6">
              <div class="text-muted small mb-1">Confirmed</div>
              <div class="fw-semibold"><%= @subscriber.confirmed_at ? @subscriber.confirmed_at.strftime("%B %d, %Y") : "Not confirmed" %></div>
            </div>
            <% if @subscriber.unsubscribed_at.present? %>
              <div class="col-12">
                <div class="text-muted small mb-1">Unsubscribed</div>
                <div class="fw-semibold"><%= @subscriber.unsubscribed_at.strftime("%B %d, %Y at %I:%M %p") %></div>
              </div>
            <% end %>
            <% if @subscriber.bounced_at.present? %>
              <div class="col-12">
                <div class="text-muted small mb-1">Bounced</div>
                <div class="fw-semibold"><%= @subscriber.bounced_at.strftime("%B %d, %Y at %I:%M %p") %></div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">Custom Attributes</h5>
          <% if @subscriber.custom_attributes.present? && @subscriber.custom_attributes.any? %>
            <div class="row g-3">
              <% @subscriber.custom_attributes.each do |key, value| %>
                <div class="col-12">
                  <div class="text-muted small mb-1"><%= key.titleize %></div>
                  <div class="fw-semibold"><%= value %></div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-muted mb-0">No custom attributes set</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- List Subscriptions -->
  <div class="mb-4">
    <h2 class="fs-4 mb-3">List Subscriptions</h2>
    <% if @list_subscriptions.any? %>
      <div class="card border">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>List</th>
                <th>Status</th>
                <th>Subscribed</th>
                <th>Unsubscribed</th>
              </tr>
            </thead>
            <tbody>
              <% @list_subscriptions.each do |subscription| %>
                <tr>
                  <td><%= link_to subscription.list.name, subscription.list, class: "text-decoration-none" %></td>
                  <td><span class="badge status-<%= subscription.status %>"><%= subscription.status.titleize %></span></td>
                  <td><%= subscription.subscribed_at ? time_ago_in_words(subscription.subscribed_at) + " ago" : "—" %></td>
                  <td><%= subscription.unsubscribed_at ? time_ago_in_words(subscription.unsubscribed_at) + " ago" : "—" %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    <% else %>
      <div class="alert alert-info">This subscriber is not subscribed to any lists.</div>
    <% end %>
  </div>

  <!-- Campaign Activity -->
  <% if @recent_campaigns.any? %>
    <div class="mb-4">
      <h2 class="fs-4 mb-3">Recent Campaign Activity</h2>
      <div class="card border">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>Campaign</th>
                <th>Status</th>
                <th>Sent</th>
                <th>Opened</th>
                <th>Clicked</th>
              </tr>
            </thead>
            <tbody>
              <% @recent_campaigns.each do |campaign_send| %>
                <tr>
                  <td><%= link_to campaign_send.campaign.name, campaign_send.campaign, class: "text-decoration-none" %></td>
                  <td><span class="badge status-<%= campaign_send.status %>"><%= campaign_send.status.titleize %></span></td>
                  <td><%= campaign_send.sent_at ? time_ago_in_words(campaign_send.sent_at) + " ago" : "—" %></td>
                  <td><%= campaign_send.opened_at ? time_ago_in_words(campaign_send.opened_at) + " ago" : "—" %></td>
                  <td><%= campaign_send.clicked_at ? time_ago_in_words(campaign_send.clicked_at) + " ago" : "—" %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>
</div>
