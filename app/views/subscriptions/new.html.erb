<div class="container py-5" style="max-width: 600px;">
  <div class="text-center mb-4">
    <h1 class="fs-2 mb-2">Subscribe to <%= @list.name %></h1>
    <% if @list.description.present? %>
      <p class="text-muted"><%= @list.description %></p>
    <% end %>
  </div>

  <% if @success %>
    <div class="alert alert-success text-center" role="alert">
      <h2 class="h5 mb-2">Success!</h2>
      <% if @pending_confirmation %>
        <p class="mb-0">Thank you for subscribing! We've sent a confirmation email to <%= @subscriber.email %>. Please check your inbox and click the confirmation link to complete your subscription.</p>
      <% else %>
        <p class="mb-0"><%= @list.form_success_message.presence || "Thank you for subscribing!" %></p>
      <% end %>
    </div>
  <% else %>
    <% if @subscriber.errors.any? %>
      <div class="alert alert-danger small" role="alert">
        <strong><%= pluralize(@subscriber.errors.count, "error") %> prevented your subscription:</strong>
        <ul class="mb-0 mt-2">
          <% @subscriber.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= form_with model: @subscriber, url: create_subscription_path(@list.id), method: :post, local: true do |f| %>
      <div class="mb-3">
        <%= f.label :email, "Email Address *", class: "form-label" %>
        <%= f.email_field :email, required: true, placeholder: "your@email.com", class: "form-control" %>
      </div>

      <% if @account.custom_field_definitions.where(required: true).exists? || @account.custom_field_definitions.any? %>
        <% @account.custom_field_definitions.order(:name).each do |field_def| %>
          <div class="mb-3">
            <%= label_tag "custom_attributes[#{field_def.name}]", field_def.name.titleize + (field_def.required? ? " *" : ""), class: "form-label" %>

            <% case field_def.field_type %>
            <% when "text", "email", "url" %>
              <%= text_field_tag "custom_attributes[#{field_def.name}]",
                                 params.dig(:custom_attributes, field_def.name),
                                 required: field_def.required?,
                                 placeholder: field_def.description,
                                 class: "form-control",
                                 type: field_def.field_type %>
            <% when "number" %>
              <%= number_field_tag "custom_attributes[#{field_def.name}]",
                                   params.dig(:custom_attributes, field_def.name),
                                   required: field_def.required?,
                                   placeholder: field_def.description,
                                   class: "form-control" %>
            <% when "date" %>
              <%= date_field_tag "custom_attributes[#{field_def.name}]",
                                 params.dig(:custom_attributes, field_def.name),
                                 required: field_def.required?,
                                 class: "form-control" %>
            <% when "boolean" %>
              <div class="form-check">
                <%= check_box_tag "custom_attributes[#{field_def.name}]",
                                  "true",
                                  params.dig(:custom_attributes, field_def.name) == "true",
                                  required: field_def.required?,
                                  class: "form-check-input" %>
              </div>
            <% end %>

            <% if field_def.description.present? %>
              <small class="form-text text-muted"><%= field_def.description %></small>
            <% end %>
          </div>
        <% end %>
      <% end %>

      <div class="d-grid mt-4 mb-3">
        <%= f.submit "Subscribe", class: "btn btn-primary" %>
      </div>

      <p class="text-center text-muted small mb-0">
        By subscribing, you agree to receive emails from <%= @account.name %>.
        You can unsubscribe at any time.
      </p>
    <% end %>
  <% end %>
</div>
