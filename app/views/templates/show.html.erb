<div class="container-fluid py-4" style="max-width: 1400px;">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2">
          <li class="breadcrumb-item"><%= link_to "Templates", templates_path %></li>
          <li class="breadcrumb-item active" aria-current="page"><%= @template.name %></li>
        </ol>
      </nav>
      <h1 class="fs-2 mb-2"><%= @template.name %></h1>
      <% if @template.is_default %>
        <span class="badge bg-primary">Default Template</span>
      <% end %>
    </div>
    <div class="d-flex gap-2">
      <%= link_to "Edit", edit_template_path(@template), class: "btn btn-outline-secondary" %>
      <%= button_to "Delete", @template, method: :delete, data: { turbo_confirm: "Are you sure? This cannot be undone." }, class: "btn btn-outline-danger" %>
    </div>
  </div>

  <!-- Template Details -->
  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="card border">
        <div class="card-body">
          <h5 class="card-title mb-3">Template Info</h5>
          <div class="mb-3">
            <div class="text-muted small mb-1">Name</div>
            <div class="fw-semibold"><%= @template.name %></div>
          </div>
          <% if @template.description.present? %>
            <div class="mb-3">
              <div class="text-muted small mb-1">Description</div>
              <div class="fw-semibold"><%= @template.description %></div>
            </div>
          <% end %>
          <div class="mb-3">
            <div class="text-muted small mb-1">Format</div>
            <div>
              <% if @template.html_content.present? %>
                <span class="badge bg-secondary">HTML</span>
              <% end %>
              <% if @template.markdown_content.present? %>
                <span class="badge bg-secondary">Markdown</span>
              <% end %>
            </div>
          </div>
          <div class="mb-3">
            <div class="text-muted small mb-1">Campaigns Using</div>
            <div class="fw-semibold"><%= @template.campaigns.count %></div>
          </div>
          <div>
            <div class="text-muted small mb-1">Created</div>
            <div class="fw-semibold"><%= @template.created_at.strftime("%B %d, %Y") %></div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-8">
      <div class="card border">
        <div class="card-body">
          <h5 class="card-title mb-3">Content Preview</h5>

          <% if @template.html_content.present? %>
            <div class="mb-3">
              <strong class="d-block mb-2">HTML Content:</strong>
              <div class="border p-3 bg-light" style="max-height: 400px; overflow-y: auto;">
                <%= sanitize(@template.html_content) %>
              </div>
            </div>
          <% end %>

          <% if @template.markdown_content.present? %>
            <div class="mb-3">
              <strong class="d-block mb-2">Markdown Content:</strong>
              <div class="border p-3 bg-light font-monospace small" style="max-height: 400px; overflow-y: auto;">
                <%= simple_format(@template.markdown_content) %>
              </div>
            </div>
          <% end %>

          <% if @template.html_content.blank? && @template.markdown_content.blank? %>
            <div class="alert alert-info">
              This template has no content yet. <%= link_to "Edit template", edit_template_path(@template) %> to add content.
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Campaigns Using This Template -->
  <% if @campaigns_using.any? %>
    <div class="mb-4">
      <h2 class="fs-4 mb-3">Campaigns Using This Template</h2>
      <div class="card border">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>Campaign</th>
                <th>Status</th>
                <th>List</th>
                <th>Created</th>
              </tr>
            </thead>
            <tbody>
              <% @campaigns_using.each do |campaign| %>
                <tr>
                  <td><%= link_to campaign.name, campaign, class: "text-decoration-none" %></td>
                  <td><span class="badge status-<%= campaign.status %>"><%= campaign.status.titleize %></span></td>
                  <td><%= link_to campaign.list.name, campaign.list, class: "text-decoration-none" %></td>
                  <td><%= time_ago_in_words(campaign.created_at) %> ago</td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>

  <div class="alert alert-info small">
    <strong>Merge Tags:</strong> Use {{email}}, {{custom_attributes.name}}, {{campaign.subject}}, {{unsubscribe_url}} in your templates.
  </div>
</div>
