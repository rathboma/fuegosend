<%= form_with(model: template, local: true) do |f| %>
  <% if template.errors.any? %>
    <div class="alert alert-danger small mb-4" role="alert">
      <strong><%= pluralize(template.errors.count, "error") %> prohibited this template from being saved:</strong>
      <ul class="mb-0 mt-2">
        <% template.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= f.label :name, "Template Name *", class: "form-label" %>
    <%= f.text_field :name, class: "form-control", placeholder: "e.g. Newsletter Template", required: true %>
  </div>

  <div class="mb-3">
    <%= f.label :description, class: "form-label" %>
    <%= f.text_area :description, class: "form-control", rows: 2, placeholder: "Optional description of this template" %>
  </div>

  <div class="mb-4">
    <div class="form-check form-switch">
      <%= f.check_box :is_default, class: "form-check-input", role: "switch" %>
      <%= f.label :is_default, "Set as default template", class: "form-check-label" %>
    </div>
    <small class="text-muted">The default template will be pre-selected when creating new campaigns</small>
  </div>

  <hr class="my-4">

  <h5 class="mb-3">Template Content</h5>

  <ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="html-tab" data-bs-toggle="tab" data-bs-target="#html-content" type="button" role="tab">HTML</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="markdown-tab" data-bs-toggle="tab" data-bs-target="#markdown-content" type="button" role="tab">Markdown</button>
    </li>
  </ul>

  <div class="tab-content mb-3">
    <div class="tab-pane fade show active" id="html-content" role="tabpanel">
      <%= f.text_area :html_content, class: "form-control font-monospace", rows: 20, placeholder: "Enter HTML content..." %>
      <small class="text-muted d-block mt-2">
        Full HTML email template. Must include complete HTML structure.
      </small>
    </div>
    <div class="tab-pane fade" id="markdown-content" role="tabpanel">
      <%= f.text_area :markdown_content, class: "form-control font-monospace", rows: 20, placeholder: "Enter Markdown content..." %>
      <small class="text-muted d-block mt-2">
        Markdown will be converted to HTML when used.
      </small>
    </div>
  </div>

  <div class="alert alert-info small mb-4">
    <strong>Available Merge Tags:</strong>
    <ul class="mb-0 mt-2">
      <li><code>{{email}}</code> - Subscriber's email address</li>
      <li><code>{{custom_attributes.name}}</code> - Custom attribute (replace 'name' with your attribute key)</li>
      <li><code>{{campaign.name}}</code> - Campaign name</li>
      <li><code>{{campaign.subject}}</code> - Campaign subject</li>
      <li><code>{{unsubscribe_url}}</code> - Unsubscribe link (required)</li>
    </ul>
  </div>

  <div class="d-flex gap-2">
    <%= f.submit template.new_record? ? "Create Template" : "Update Template", class: "btn btn-primary" %>
    <%= link_to "Cancel", template.new_record? ? templates_path : template, class: "btn btn-outline-secondary" %>
  </div>
<% end %>
